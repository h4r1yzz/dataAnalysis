# Scout Agent Visualization Implementation

This document describes the complete implementation of Plotly chart visualization in the Scout Agent chat interface.

## Overview

The Scout Agent now supports automatic detection and rendering of Plotly visualizations generated by the backend. When the agent creates a visualization, it automatically appears in the chat interface.

## Architecture

### Backend (Python)
- **Visualization Generation**: `scout/my_mcp/local_servers/datalysis_mcp.py`
  - Uses Plotly (plotly.express, plotly.graph_objects) to generate charts
  - Saves visualizations as JSON files in the `output/` directory
  - Supports all Plotly chart types (bar, line, scatter, pie, heatmap, etc.)

- **API Endpoint**: `api_server.py`
  - New endpoint: `GET /visualizations/{filename}`
  - Serves Plotly JSON files from the output directory
  - Includes proper CORS headers and error handling

### Frontend (React/TypeScript)
- **PlotlyChart Component**: `frontend/src/components/ui/plotly-chart.tsx`
  - Reusable component using react-plotly.js
  - Handles loading states, error states, and responsive design
  - Follows shadcn/ui design patterns

- **Enhanced MessageBubble**: `frontend/src/components/chat/MessageBubble.tsx`
  - Automatically detects visualization references in assistant messages
  - Fetches and displays charts when visualizations are created
  - Maintains clean chat UI design

- **Type Definitions**: `frontend/src/types/chat.ts`
  - Extended ChatMessage interface with visualization support
  - Added PlotlyData and VisualizationMetadata types

## How It Works

1. **User Request**: User asks for a visualization through the chat interface
2. **Backend Processing**: Scout agent generates Plotly code and saves JSON to output directory
3. **Message Detection**: Frontend detects success messages containing visualization references
4. **Automatic Display**: Charts are automatically fetched and rendered in the chat

## Visualization Detection Patterns

The system detects these patterns in assistant messages:
- `Visualization 'chart_name' created successfully`
- `Visualization "chart_name" created successfully`
- `saved to output/chart_name.json`

## Supported Chart Types

Since the system uses Plotly, it supports all Plotly visualization types:
- Bar charts
- Line charts
- Scatter plots
- Pie charts
- Histograms
- Heatmaps
- 3D visualizations
- Geographic maps
- Box plots, violin plots
- And more...

## Example Usage

```
User: "Show me the top 5 creators by revenue"
Scout: "I'll create a visualization showing the top 5 creators by revenue.

[Executes SQL query and generates chart]

Visualization 'top_creators_revenue' created successfully and saved to output/top_creators_revenue.json"

[Chart automatically appears in the chat]
```

## Technical Details

### API Endpoint
```
GET /visualizations/{filename}
- Returns: Plotly JSON data
- CORS: Enabled for localhost:3000 and localhost:3001
- Error handling: 404 for missing files, 500 for JSON errors
```

### Component Props
```typescript
interface PlotlyChartProps {
  data: PlotlyData;
  className?: string;
  onError?: (error: Error) => void;
}
```

### Responsive Design
- Charts automatically resize with container
- Mobile-friendly responsive layout
- Dark mode support
- Consistent with existing UI design

## Error Handling

- **Loading States**: Animated loading indicators
- **Network Errors**: User-friendly error messages
- **Invalid Data**: Graceful fallback with error display
- **Missing Files**: Clear 404 error messages

## Performance Considerations

- **Dynamic Import**: Plotly is loaded only when needed (SSR-safe)
- **Caching**: Browser caches visualization JSON files
- **Responsive**: Charts use ResizeHandler for optimal performance
- **Memory**: Components properly clean up on unmount

## Future Enhancements

Potential improvements for the visualization system:
- Visualization thumbnails in chat
- Export functionality (PNG, SVG, PDF)
- Interactive chart editing
- Chart sharing capabilities
- Visualization history/gallery
